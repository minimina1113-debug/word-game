<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´å­—è©èªå¡«ç©ºæŒ‘æˆ°</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­ç½®å…¨å±€å­—é«”ç‚º Interï¼Œä¸¦æ·»åŠ ä¸­æ–‡å­—é«”æ”¯æŒ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+TC:wght@100..900&display=swap');
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background-color: #0d1b2a; /* æ·±æµ·ä¸»é¡Œè— */
            color: #ffffff;
            min-height: 100vh;
        }

        /* 3D å¡ç‰Œç¿»è½‰æ•ˆæœè¨­ç½® */
        .card-container {
            perspective: 1000px; /* è¨­ç½®é€è¦–æ·±åº¦ */
            height: 200px; /* å›ºå®šå¡ç‰Œé«˜åº¦ */
        }

        .card {
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .card.flipped {
            transform: rotateY(180deg);
            pointer-events: none; /* ç¿»è½‰å¾Œç¦æ­¢å†æ¬¡é»æ“Š */
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* éš±è—èƒŒé¢ */
            border-radius: 10px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow-y: auto; /* å…è¨±èƒŒé¢å…§å®¹æ»¾å‹• */
        }

        .card-front {
            background-color: #415a77; /* å¡ç‰Œæ­£é¢é¡è‰² - è¼ƒæ·±çš„è— */
            font-size: 2.5rem;
            font-weight: bold;
            color: #e0fbfc; /* æ·ºè‰²æ–‡å­— */
            transition: background-color 0.3s;
        }

        .card-front:hover {
            background-color: #5d7e9e;
        }

        .card-back {
            background-color: #e0fbfc; /* å¡ç‰ŒèƒŒé¢é¡è‰² - æ·ºæ°´è‰² */
            color: #0d1b2a;
            transform: rotateY(180deg); /* åˆå§‹æ—‹è½‰ 180 åº¦ */
            text-align: left;
            padding: 1rem;
        }

        /* ç­”æ¡ˆå¡ç‰Œçš„é‚Šæ¡†æ¨£å¼ */
        .correct {
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            border: 3px solid #00f0ff;
        }

        .incorrect {
            box-shadow: 0 0 20px rgba(255, 50, 50, 0.8);
            border: 3px solid #ff3232;
        }

        /* å¡«ç©ºæ¡†æ¨£å¼ */
        .missing-char-box {
            display: inline-block;
            width: auto; /* è®“å¯¬åº¦é©æ‡‰å…§å®¹ */
            min-width: 5rem;
            height: 1.2em; 
            border-bottom: 3px solid #ffd166; /* è­¦å‘Šé»ƒåº•ç·š */
            margin: 0 0.25rem;
            text-align: center;
            vertical-align: middle;
            font-size: 1em; 
            transition: all 0.5s ease-out;
        }
        
        .answer-text {
            font-size: 1.8rem;
            font-weight: 900;
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center">

    <header class="text-center mb-8">
        <h1 class="text-4xl font-extrabold text-[#9d4edd] tracking-wide mb-2">ğŸŒŠ æ°´å­—è©èªå¡«ç©ºæŒ‘æˆ° ğŸ’¦</h1>
        <p class="text-lg text-gray-300">è«‹é¸æ“‡æ­£ç¢ºçš„è©èªï¼Œå®ŒæˆåŒ…å«ã€Œæ°´ã€å­—çš„å¥å­ï¼</p>
    </header>

    <main class="w-full max-w-5xl">
        
        <!-- éŠæˆ²è¨Šæ¯èˆ‡å¾—åˆ†å€ -->
        <div id="game-info" class="flex flex-wrap justify-between items-center mb-6 p-4 bg-[#1b263b] rounded-xl shadow-lg">
            <div class="text-xl font-semibold mb-2 sm:mb-0">
                ç›®å‰é€²åº¦ï¼š<span id="question-progress" class="text-yellow-400">0/10</span>
            </div>
            <div id="message-box" class="text-xl font-bold text-center transition-opacity duration-300 opacity-0 min-h-[1.5rem] flex-grow mx-4">
                <!-- éŠæˆ²æç¤ºè¨Šæ¯æœƒåœ¨é€™è£¡é¡¯ç¤º -->
            </div>
            <div class="score-info text-xl font-semibold mt-2 sm:mt-0">
                å¾—åˆ†ï¼š<span id="score" class="text-yellow-400">0</span>
            </div>
            
            <button id="next-button" onclick="loadNextQuestion()" class="mt-4 sm:mt-0 sm:ml-4 px-6 py-2 bg-[#ff5722] hover:bg-[#e64a19] rounded-lg font-bold transition duration-300 transform scale-0 invisible whitespace-nowrap">
                ä¸‹ä¸€é¡Œ
            </button>
        </div>

        <!-- ä¾‹å¥å±•ç¤ºå€ -->
        <div class="text-center mb-10 p-6 bg-[#354f52] rounded-2xl shadow-xl border-b-4 border-l-2 border-[#52796f]">
            <p id="sentence" class="text-2xl sm:text-3xl font-bold italic leading-relaxed">
                <!-- ä¾‹å¥å…§å®¹ -->
            </p>
        </div>
        
        <!-- å¡ç‰Œé¸æ“‡å€ (4x å®¹å™¨) -->
        <div id="card-area" class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <!-- Card elements will be generated here -->
        </div>
    </main>

    <script>
        // éŠæˆ²æ•¸æ“šåº« (åŒ…å«è©èªã€å¥å­ã€æ³¨éŸ³å’Œæ„æ€)
        const allWords = [
            { word: 'æ·¹æ°´', bopomofo: 'ã„§ã„¢ ã„•ã„¨ã„ŸË‡', meaning: 'æ°´æ‚£ï¼ŒæŒ‡å¤§æ°´æ¼«éæˆ–æµ¸æ²’åœ°é¢ã€æˆ¿å±‹ã€‚', sentences: ['æ˜¨å¤©çš„æš´é›¨å°è‡´åŸå¸‚è¨±å¤šåœ°å€éƒ½_____äº†ã€‚', 'å¦‚æœæ’æ°´ç³»çµ±ä¸è‰¯ï¼Œå¤§é›¨éå¾Œå¾ˆå®¹æ˜“_____ã€‚', 'ç‚ºäº†é¿å…_____ï¼Œæˆ‘å€‘æº–å‚™äº†æ²™åŒ…æ“‹åœ¨é–€å£ã€‚'] },
            { word: 'æ°´æœ', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„ã„¨ã„›Ë‡', meaning: 'å¯é£Ÿç”¨çš„å¤šæ±æœå¯¦ï¼Œå¯Œå«ç¶­ç”Ÿç´ ã€‚', sentences: ['å¤å¤©æ™‚ï¼Œå¤šåƒé»_____æœ‰ç›Šå¥åº·ã€‚', 'å¥¹å–œæ­¡åœ¨é£¯å¾Œåˆ‡ä¸€ç›¤æ–°é®®çš„_____ã€‚', 'é€™å®¶åº—è³£çš„é€²å£_____ç¨®é¡éå¸¸å¤šã€‚'] },
            { word: 'æ°´å¹³', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„†ã„§ã„¥ËŠ', meaning: 'è¡¡é‡çš„æ¨™æº–æˆ–é”åˆ°çš„ç¨‹åº¦ã€‚', sentences: ['ç¶“éåŠªåŠ›ç·´ç¿’ï¼Œä»–çš„è‹±æ–‡_____æœ‰äº†é¡¯è‘—æå‡ã€‚', 'æˆ‘å€‘æ‡‰ç•¶åŠªåŠ›æé«˜ç”Ÿæ´»çš„_____å’Œè³ªé‡ã€‚', 'é€™å¡ŠåœŸåœ°çš„_____å„€é¡¯ç¤ºå®Œå…¨æ˜¯å¹³çš„ã€‚'] },
            { word: 'é–‹æ°´', bopopmfo: 'ã„ã„ ã„•ã„¨ã„ŸË‡', meaning: 'ç…®æ²¸å¾Œå†·å»æˆ–æº«ç†±çš„æ°´ï¼Œå¯ç›´æ¥é£²ç”¨ã€‚', sentences: ['é£²ç”¨å‰è«‹å…ˆå°‡_____ç…®æ²¸ï¼Œç¢ºä¿è¡›ç”Ÿã€‚', 'é‹å‹•å¾Œè¦å¤šå–_____è£œå……æµå¤±çš„æ°´åˆ†ã€‚', 'è«‹çµ¦æˆ‘ä¸€æ¯æº«_____ï¼Œè¬è¬ã€‚'] },
            { word: 'æ½›æ°´', bopomofo: 'ã„‘ã„§ã„¢ËŠ ã„•ã„¨ã„ŸË‡', meaning: 'ç©¿æˆ´ç‰¹æ®Šè£å‚™ï¼Œæ½›å…¥æ°´ä¸­æ´»å‹•æˆ–æ¢éšªã€‚', sentences: ['ä»–æœ€å¤§çš„èˆˆè¶£æ˜¯åˆ°æ·±æµ·é€²è¡Œ_____æ”å½±ã€‚', 'é€™æ¬¡æ—…è¡Œæˆ‘å€‘å ±åäº†é«”é©—_____çš„èª²ç¨‹ã€‚', 'å°ˆæ¥­_____å“¡å¯ä»¥æ¢ç´¢æ·±é”æ•¸åå…¬å°ºçš„æµ·åº•ä¸–ç•Œã€‚'] },
            { word: 'æ·šæ°´', bopomofo: 'ã„Œã„ŸË‹ ã„•ã„¨ã„ŸË‡', meaning: 'çœ¼ç›åˆ†æ³Œçš„æ¶²é«”ï¼Œé€šå¸¸å› æƒ…ç·’æ³¢å‹•æˆ–ç•°ç‰©åˆºæ¿€è€Œç”¢ç”Ÿã€‚', sentences: ['è½åˆ°é‚£å€‹æ„Ÿäººçš„æ•…äº‹ï¼Œå¥¹å¿ä¸ä½æµä¸‹äº†_____ã€‚', 'é›–ç„¶å¤±æ•—äº†ï¼Œä½†ä»–æ“¦ä¹¾_____ï¼Œæ±ºå®šé‡æ–°å†ä¾†ã€‚', 'å–œæ‚…çš„_____æ¨¡ç³Šäº†å¥¹çš„è¦–ç·šã€‚'] },
            { word: 'æ¸…æ°´', bopomofo: 'ã„‘ã„§ã„¥ ã„•ã„¨ã„ŸË‡', meaning: 'æ½”æ·¨ã€ç„¡è‰²çš„æ°´ã€‚', sentences: ['è«‹ç”¨_____æ¸…æ´—ç¢—ç­·ï¼Œä¸è¦ç”¨è‚¥çš‚ã€‚', 'é€™æ¢å°æºªçš„_____å¯ä»¥ç›´æ¥çœ‹åˆ°åº•ä¸‹çš„çŸ³é ­ã€‚', 'ä»–åªç”¨_____ç…®éºµï¼Œèª¿å‘³éå¸¸ç°¡å–®ã€‚'] },
            { word: 'å™´æ°´', bopomofo: 'ã„†ã„£ ã„•ã„¨ã„ŸË‡', meaning: 'å°‡æ°´ä»¥éœ§ç‹€æˆ–å°„æµç‹€å™´å°„å‡ºä¾†ã€‚', sentences: ['å…¬åœ’è£¡çš„é›•åƒæ¯éš”ä¸€å°æ™‚æœƒè‡ªå‹•_____ã€‚', 'æ¶ˆé˜²è»ŠæŠµé”å¾Œç«‹å³é–‹å§‹å°ç«å ´_____æ»…ç«ã€‚', 'é‚£å€‹èª¿çš®çš„å­©å­ç”¨_____æ§å°è‘—è·¯äººå°„æ“Šã€‚'] },
            { word: 'æµ·æ°´', bopomofo: 'ã„ã„Ë‡ ã„•ã„¨ã„ŸË‡', meaning: 'æµ·æ´‹ä¸­çš„æ°´ã€‚', sentences: ['é€™ç‰‡_____è—å¾—åƒå¯¶çŸ³ä¸€æ¨£ç¾éº—ã€‚', 'ä»–ç¬¬ä¸€æ¬¡åšåˆ°_____ï¼Œæ„Ÿè¦ºåˆé¹¹åˆæ¾€ã€‚', 'å¤•é™½ç‘åœ¨_____ä¸Šï¼Œæ³¢å…‰ç²¼ç²¼ã€‚'] },
            { word: 'æ±½æ°´', bopomofo: 'ã„‘ã„§Ë‹ ã„•ã„¨ã„ŸË‡', meaning: 'å«æœ‰äºŒæ°§åŒ–ç¢³çš„ç”œå‘³é£²æ–™ã€‚', sentences: ['é€™ç¨®ç”œç”œçš„_____æ˜¯å°æœ‹å‹çš„æœ€æ„›ã€‚', 'ç‚ç†±çš„å¤å¤©ï¼Œä¾†ä¸€æ¯å†°é®çš„_____éå¸¸æš¢å¿«ã€‚', 'ä»–æ‰“é–‹ç“¶è“‹ï¼Œ_____è£¡çš„æ°£æ³¡ä¸æ–·å†’å‡ºä¾†ã€‚'] },
            { word: 'æ°´å¡”', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„Šã„šË‡', meaning: 'ä¸€ç¨®é«˜æ¶çš„å„²æ°´è¨­æ–½ã€‚', sentences: ['å±‹é ‚ä¸Šæ¶è¨­äº†_____ä¾†å„²å­˜ç”Ÿæ´»ç”¨æ°´ã€‚', 'æ¸…æ´—_____æ˜¯ç¶­è­·é£²ç”¨æ°´è¡›ç”Ÿçš„é‡è¦æ­¥é©Ÿã€‚', 'é è™•é‚£å€‹åœ“å½¢çš„é«˜æ¶å»ºç¯‰å°±æ˜¯å°é®çš„_____ã€‚'] },
            { word: 'æ°´åº«', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„ã„¨Ë‹', meaning: 'æ””æ²³ç¯‰å£©è“„æ°´ï¼Œç”¨æ–¼é˜²æ´ªã€çŒæº‰æˆ–ç™¼é›»çš„å·¥ç¨‹è¨­æ–½ã€‚', sentences: ['ç‚ºäº†é˜²æ´ªå’ŒçŒæº‰ï¼Œæ”¿åºœä¿®å»ºäº†å¤§å‹_____ã€‚', 'å¦‚æœ_____æ°´ä½éä½ï¼Œå°±æœƒå½±éŸ¿æ°‘ç”Ÿä¾›æ°´ã€‚', 'æ–°èå ±å°äº†_____æ­£åœ¨é€²è¡Œæ´©æ´ªçš„æ¶ˆæ¯ã€‚'] },
            { word: 'æ°´é›»', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„‰ã„§ã„¢Ë‹', meaning: 'æ°´å’Œé›»ï¼Œå¸¸æŒ‡ç”Ÿæ´»ä¸­çš„åŸºç¤å…¬ç”¨äº‹æ¥­è²»ç”¨ã€‚', sentences: ['æ¯å€‹æœˆéƒ½è¦ç¹³äº¤ç“¦æ–¯å’Œ_____è²»ã€‚', 'æˆ¿æ±èªªæˆ¿ç§Ÿä¸åŒ…å«_____å’Œç¶²è·¯è²»ç”¨ã€‚', 'é€™æ¬¡é¢±é¢¨é€ æˆè¨±å¤šåœ°å€_____ä¾›æ‡‰ä¸­æ–·ã€‚'] },
            { word: 'å£æ°´', bopomofo: 'ã„ã„¡Ë‡ ã„•ã„¨ã„ŸË‡', meaning: 'å”¾æ¶²ï¼Œå£è…”å…§åˆ†æ³Œçš„æ¶²é«”ã€‚', sentences: ['çœ‹åˆ°æ¡Œä¸Šçš„ç¾é£Ÿï¼Œä»–å¿ä¸ä½æµä¸‹äº†_____ã€‚', 'èªªè©±æ™‚è«‹æ³¨æ„ä¸è¦_____å››æ¿ºã€‚', 'å¬°å…’é•·ç‰™æ™‚å¸¸å¸¸æœƒæµ_____ã€‚'] },
            { word: 'æº«æ°´', bopomofo: 'ã„¨ã„£ ã„•ã„¨ã„ŸË‡', meaning: 'æº«åº¦é©ä¸­çš„æ°´ï¼Œä¸å†·ä¹Ÿä¸ç†±ã€‚', sentences: ['é†«ç”Ÿå»ºè­°ä»–å¤šå–_____ï¼Œæœ‰åŠ©æ–¼èº«é«”æ¢å¾©ã€‚', 'æ³¡è…³æ™‚æ‡‰è©²ç”¨ç´„å››ååº¦çš„_____ã€‚', 'ä»–ç”¨_____ç·©æ…¢åœ°æ¸…æ´—è‘—å‚·å£ã€‚'] },
            // --- æ–°å¢ 10 çµ„è©èª ---
            { word: 'æ·¡æ°´', bopomofo: 'ã„‰ã„¢Ë‹ ã„•ã„¨ã„ŸË‡', meaning: 'ä¸å«é¹½åˆ†çš„æ°´ï¼Œå¦‚æ²³æ°´ã€æ¹–æ°´ç­‰ã€‚', sentences: ['äººé¡çš„ç”Ÿå­˜ä¾è³´æ–¼_____è³‡æºã€‚', 'é€™æ¢æ²³æµè£¡çš„éƒ½æ˜¯_____ï¼Œå¯ä»¥é£²ç”¨ã€‚', 'ç§‘å­¸å®¶æ­£åœ¨ç ”ç©¶å¦‚ä½•æ·¨åŒ–è¢«æ±¡æŸ“çš„_____ã€‚'] },
            { word: 'æ°´æ»´', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„‰ã„§', meaning: 'å¾®å°çš„æ°´ç ã€‚', sentences: ['åœ¨è‘‰ç‰‡ä¸Šï¼Œæ™¶ç‘©çš„_____åå°„è‘—é™½å…‰ã€‚', 'ç¶“éé•·æ™‚é–“çš„ç´¯ç©ï¼Œ_____ä¹Ÿèƒ½ç©¿é€çŸ³é ­ã€‚', 'æ¿•æ°£å‡çµæˆ_____ï¼Œé™„è‘—åœ¨çª—æˆ¶ä¸Šã€‚'] },
            { word: 'æ°´å¢¨', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„‡ã„›Ë‹', meaning: 'ä¸­åœ‹å‚³çµ±ç¹ªç•«ï¼Œä»¥æ°´èª¿å’Œå¢¨è‰²ä½œç•«ã€‚', sentences: ['é€™å¹…å±±_____ç•«è¡¨ç¾å‡ºé«˜é çš„æ„å¢ƒã€‚', 'ä»–æ“…é•·ä»¥ç°¡å–®çš„ç·šæ¢å‹¾å‹’å‡º_____çš„éŸ»å‘³ã€‚', 'åšç‰©é¤¨æ­£åœ¨å±•å‡ºç•¶ä»£_____è—è¡“ä½œå“ã€‚'] },
            { word: 'ç†±æ°´', bopomofo: 'ã„–ã„œË‹ ã„•ã„¨ã„ŸË‡', meaning: 'æº«åº¦è¼ƒé«˜çš„æ°´ã€‚', sentences: ['å†¬å¤©æ´—æ¾¡æ™‚ï¼Œéœ€è¦ç”¨_____æ²–æš–èº«é«”ã€‚', 'è«‹çµ¦æˆ‘ä¸€æ¯_____ï¼Œæˆ‘è¦æ³¡èŒ¶ã€‚', 'é€™å€‹ä¿æº«ç“¶å¯ä»¥è®“_____ä¿æŒæº«åº¦è¶…éå…«å°æ™‚ã€‚'] },
            { word: 'æ°´ç½', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„—ã„', meaning: 'ç”±æ´ªæ°´æˆ–æš´é›¨å¼•èµ·çš„ç½å®³ã€‚', sentences: ['é¢±é¢¨éå¾Œï¼Œä½çªªåœ°å€å®¹æ˜“ç™¼ç”Ÿ_____ã€‚', 'æ”¿åºœè¿…é€Ÿçµ„ç¹”äº†æ•‘æ´éšŠä¼å‰å¾€_____å€ã€‚', 'é€™æ¬¡çš„_____é€ æˆäº†åš´é‡çš„è¾²ä½œç‰©æå¤±ã€‚'] },
            { word: 'æ°´é¤ƒ', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„ã„§ã„ Ë‡', meaning: 'ä¸€ç¨®å¸¸è¦‹çš„ä¸­å¼éºµé£Ÿï¼Œé€šå¸¸ç…®ç†Ÿé£Ÿç”¨ã€‚', sentences: ['æ™šé¤æˆ‘æƒ³åƒä¸€ç›¤é¦™è‡é«˜éº—èœé¤¡çš„_____ã€‚', 'å†·å‡_____æ˜¯å¾ˆæ–¹ä¾¿çš„é€Ÿé£Ÿé¸æ“‡ã€‚', 'é€™å®¶åº—çš„_____çš®è–„é¤¡å¤šï¼Œéå¸¸ç¾å‘³ã€‚'] },
            { word: 'æ³‰æ°´', bopomofo: 'ã„‘ã„©ã„¢ËŠ ã„•ã„¨ã„ŸË‡', meaning: 'å¾åœ°ä¸‹è‡ªç„¶æ¹§å‡ºçš„æ°´ã€‚', sentences: ['ç™»å±±å®¢ç™¼ç¾äº†ä¸€è™•æ¸…ç”œçš„å¤©ç„¶_____ã€‚', 'é€™åº§å±±è°·è£¡æœ‰å¹¾çœ¼_____ï¼Œçµ‚å¹´ä¸çµ•ã€‚', 'æˆ‘å€‘ç”¨ç“¶å­æ¥æ»¿äº†å†°æ¶¼çš„_____è§£æ¸´ã€‚'] },
            { word: 'æ°´æ˜Ÿ', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„’ã„§ã„¥', meaning: 'å¤ªé™½ç³»ä¸­æœ€é è¿‘å¤ªé™½çš„è¡Œæ˜Ÿã€‚', sentences: ['å¤©æ–‡å­¸å®¶æ­£åœ¨è§€å¯Ÿ_____çš„è»Œé“å’Œåœ°è¡¨ç‰¹å¾µã€‚', '_____æ˜¯å¤ªé™½ç³»ä¸­é‹è¡Œé€Ÿåº¦æœ€å¿«çš„è¡Œæ˜Ÿã€‚', 'æˆ‘å€‘å¯ä»¥åœ¨æ¸…æ™¨æˆ–é»ƒæ˜çœ‹åˆ°_____ã€‚'] },
            { word: 'æ°´æ€§', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„’ã„§ã„¥Ë‹', meaning: 'æŒ‡ç‰©è³ªæº¶æ–¼æ°´çš„æ€§è³ªæˆ–äººå°æ°´çš„é©æ‡‰èƒ½åŠ›ï¼ˆæ¸¸æ³³ï¼‰ã€‚', sentences: ['ä»–çš„_____å¾ˆå¥½ï¼Œè¼•é¬†å°±èƒ½æ¸¸åˆ°å°å²¸ã€‚', 'é€™ç¨®æ²¹æ¼†æ˜¯_____çš„ï¼Œç„¡æ¯’åˆç’°ä¿ã€‚', 'ç”±æ–¼æ²’æœ‰ç¶“éè¨“ç·´ï¼Œä»–çš„_____é‚„å¾ˆå·®ã€‚'] },
            { word: 'æ°´æº', bopomofo: 'ã„•ã„¨ã„ŸË‡ ã„ã„¡', meaning: 'äººå·¥æŒ–æ˜æˆ–ä¿®å»ºçš„æ’æ°´é€šé“ã€‚', sentences: ['ç‚ºäº†é †åˆ©æ’æ°´ï¼Œå¿…é ˆå®šæœŸæ¸…ç†è¡—é“æ—çš„_____ã€‚', 'é¢±é¢¨ä¾†è¥²å‰ï¼Œå·¥äººå€‘æª¢æŸ¥äº†æ‰€æœ‰çš„_____è“‹ã€‚', 'ä¸€éš»å°è²“ä¸å°å¿ƒæ‰é€²äº†è·¯é‚Šçš„_____è£¡ã€‚'] }
        ];

        let gameQuestions = []; // æœ¬æ¬¡éŠæˆ²çš„ 10 å€‹éš¨æ©Ÿé¡Œç›®
        let currentQuestionIndexInBatch = -1;
        let currentQuestionData = null; // ç•¶å‰é¡Œç›®çš„å®Œæ•´æ•¸æ“š
        let score = 0;
        let isCardFlipped = false; // è¿½è¹¤å¡ç‰Œæ˜¯å¦å·²ç¶“ç¿»é¢

        const sentenceEl = document.getElementById('sentence');
        const scoreEl = document.getElementById('score');
        const progressEl = document.getElementById('question-progress');
        const messageBoxEl = document.getElementById('message-box');
        const nextButton = document.getElementById('next-button');
        const cardAreaEl = document.getElementById('card-area');

        /**
         * æ··æ·†é™£åˆ— (Fisher-Yates Shuffle)
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * å–å¾—éš¨æ©Ÿçš„ä¸é‡è¤‡éŒ¯èª¤é¸é …
         */
        function getIncorrectOptions(correctWord, allWordsData, count = 3) {
            const pool = allWordsData.filter(item => item.word !== correctWord);
            shuffleArray(pool);
            return pool.slice(0, count); // è¿”å›å®Œæ•´çš„è©èªå°è±¡ï¼ŒåŒ…å«æ„æ€å’Œæ³¨éŸ³
        }

        /**
         * åˆå§‹åŒ–éŠæˆ²ï¼šéš¨æ©ŸæŠ½å– 10 é¡Œ
         */
        function initializeGame() {
            score = 0;
            scoreEl.textContent = score;
            nextButton.textContent = "ä¸‹ä¸€é¡Œ";
            nextButton.onclick = loadNextQuestion;
            currentQuestionIndexInBatch = -1;
            
            // éš¨æ©ŸæŠ½å– 10 å€‹é¡Œç›® (ä½¿ç”¨éš¨æ©Ÿç´¢å¼•ï¼Œç¢ºä¿ä¸é‡è¤‡)
            const allIndices = Array.from({ length: allWords.length }, (_, i) => i);
            shuffleArray(allIndices);
            const numQuestions = Math.min(10, allWords.length);
            gameQuestions = allIndices.slice(0, numQuestions).map(i => allWords[i]);

            if (gameQuestions.length > 0) {
                loadNextQuestion();
            } else {
                showMessage('éŠæˆ²è³‡æ–™åº«ç‚ºç©ºï¼Œç„¡æ³•é–‹å§‹éŠæˆ²ï¼', 'text-red-400');
            }
        }

        /**
         * è¨­ç½®å¡ç‰Œçš„ HTML çµæ§‹
         */
        function generateCardHTML(index, word) {
            return `
                <div id="card-${index}-container" class="card-container" onclick="handleCardClick(${index})">
                    <div id="card-${index}" class="card">
                        <div class="card-face card-front flex items-center justify-center">
                            ${word}
                        </div>
                        <div class="card-face card-back p-3 sm:p-4">
                            <div id="card-${index}-content">
                                <!-- å¡ç‰ŒèƒŒé¢å…§å®¹ -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


        /**
         * è¨­ç½®ç•¶å‰é¡Œç›®
         */
        function setupQuestion() {
            currentQuestionData = gameQuestions[currentQuestionIndexInBatch];
            isCardFlipped = false;
            nextButton.classList.add('scale-0', 'invisible');
            messageBoxEl.classList.remove('opacity-100');
            messageBoxEl.classList.add('opacity-0');
            cardAreaEl.innerHTML = ''; // æ¸…ç©ºå¡ç‰Œå€åŸŸ
            
            // æ›´æ–°é€²åº¦é¡¯ç¤º
            progressEl.textContent = `${currentQuestionIndexInBatch + 1}/${gameQuestions.length}`;

            const correctWordData = currentQuestionData;
            
            // 1. æº–å‚™é¸é …
            const incorrectOptionsData = getIncorrectOptions(correctWordData.word, allWords, 3);
            const allOptionsData = [correctWordData, ...incorrectOptionsData];
            shuffleArray(allOptionsData);
            
            currentQuestionData.currentOptionsData = allOptionsData; // å­˜å„²æœ¬æ¬¡é¸é …æ•¸æ“š

            // 2. éš¨æ©Ÿé¸å–ä¸€å€‹ä¾‹å¥
            const sentences = correctWordData.sentences;
            const randomIndex = Math.floor(Math.random() * sentences.length);
            const randomSentence = sentences[randomIndex];
            
            // 3. æ¸²æŸ“å¥å­
            const displaySentence = randomSentence.replace('_____', `<span id="missing-box" class="missing-char-box bg-[#1b263b]/40 rounded-sm"></span>`);
            sentenceEl.innerHTML = displaySentence;
            
            // 4. æ¸²æŸ“å¡ç‰Œ
            let cardHTML = '';
            for (let i = 0; i < allOptionsData.length; i++) {
                cardHTML += generateCardHTML(i, allOptionsData[i].word);
            }
            cardAreaEl.innerHTML = cardHTML;
            
            // 5. ç¢ºä¿æ‰€æœ‰å¡ç‰Œå¯é»æ“Š
            for (let i = 0; i < 4; i++) {
                 document.getElementById(`card-${i}-container`).style.cursor = 'pointer';
                 // ç§»é™¤ä¹‹å‰çš„æ­£ç¢º/éŒ¯èª¤æ¨™è¨˜
                 document.getElementById(`card-${i}-container`).classList.remove('correct', 'incorrect');
                 document.getElementById(`card-${i}`).classList.remove('flipped');
            }
        }

        /**
         * æ›´æ–°å¡ç‰ŒèƒŒé¢çš„è©³ç´°å…§å®¹
         */
        function updateCardBackContent(cardIndex, data) {
            const contentEl = document.getElementById(`card-${cardIndex}-content`);
            contentEl.innerHTML = `
                <h2 class="text-3xl font-black mb-1 text-[#0d1b2a] answer-text">${data.word}</h2>
                <p class="text-xl font-semibold mb-2 text-gray-700">æ³¨éŸ³: ${data.bopomofo}</p>
                <div class="w-full h-px bg-gray-400 my-1"></div>
                <div class="w-full mt-2 text-left">
                    <h3 class="text-lg font-bold text-[#415a77] mb-1">è©ç¾©ï¼š</h3>
                    <p class="text-base text-gray-800">${data.meaning}</p>
                </div>
            `;
        }


        /**
         * è™•ç†å¡ç‰Œé»æ“Šäº‹ä»¶
         */
        function handleCardClick(clickedIndex) {
            if (isCardFlipped) return; 
            isCardFlipped = true; // é–å®šé»æ“Š

            const chosenWordData = currentQuestionData.currentOptionsData[clickedIndex];
            const correctWord = currentQuestionData.word;
            const isCorrect = (chosenWordData.word === correctWord);
            let correctIndex = -1;

            // 1. ç¦ç”¨æ‰€æœ‰å¡ç‰Œé»æ“Šä¸¦æ‰¾åˆ°æ­£ç¢ºç­”æ¡ˆçš„ç´¢å¼•
            for (let i = 0; i < 4; i++) {
                 document.getElementById(`card-${i}-container`).style.cursor = 'default';
                 if (currentQuestionData.currentOptionsData[i].word === correctWord) {
                    correctIndex = i;
                 }
            }

            // 2. ç«‹å³å¡«å…¥å¡«ç©ºæ¡†ä¸¦æ›´æ–°åˆ†æ•¸/æç¤º
            const missingBox = document.getElementById('missing-box');
            missingBox.textContent = chosenWordData.word;
            missingBox.classList.remove('missing-char-box', 'bg-[#1b263b]/40');
            missingBox.style.borderBottom = 'none';

            if (isCorrect) {
                score++;
                missingBox.classList.add('text-green-400', 'answer-text');
                showMessage('âœ”ï¸ æ­£ç¢ºï¼ç­”æ¡ˆå¡å·²ç¿»é¢ï¼Œè«‹ä»”ç´°é–±è®€è©ç¾©ã€‚', 'text-green-400');
            } else {
                // é›–ç„¶é¸éŒ¯äº†ï¼Œä½†å¡«ç©ºæ¡†ä»é¡¯ç¤ºä½¿ç”¨è€…é¸çš„ç­”æ¡ˆ
                missingBox.classList.add('text-red-400', 'answer-text');
                showMessage('âŒ éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆå¡æœƒå…ˆç¿»é¢ï¼Œè«‹æ³¨æ„æ¯”è¼ƒã€‚', 'text-red-400');
            }
            scoreEl.textContent = score;

            // 3. Phase 1: ç«‹å³ç¿»è½‰æ­£ç¢ºç­”æ¡ˆå¡
            if (correctIndex !== -1) {
                const correctCardEl = document.getElementById(`card-${correctIndex}`);
                const correctContainerEl = document.getElementById(`card-${correctIndex}-container`);
                
                // ç¿»è½‰å¡ç‰Œ
                correctCardEl.classList.add('flipped');
                
                // è¨­ç½®å¡ç‰ŒèƒŒé¢å…§å®¹
                updateCardBackContent(correctIndex, currentQuestionData.currentOptionsData[correctIndex]);

                // æ¨™è¨˜æ­£ç¢ºç­”æ¡ˆ
                correctContainerEl.classList.add('correct');

                // å¦‚æœä½¿ç”¨è€…é¸éŒ¯ï¼Œå°‡éŒ¯èª¤å¡ç‰Œä¹Ÿæ¨™è¨˜å‡ºä¾†
                if (!isCorrect) {
                    document.getElementById(`card-${clickedIndex}-container`).classList.add('incorrect');
                }
            }


            // 4. Phase 2: å»¶é² 5 ç§’å¾Œï¼Œç¿»è½‰æ‰€æœ‰æœªç¿»è½‰çš„å¡ç‰‡
            setTimeout(() => {
                for (let i = 0; i < 4; i++) {
                    const cardEl = document.getElementById(`card-${i}`);
                    
                    // å¦‚æœå¡ç‰‡é‚„æ²’ç¿»è½‰ (å³éæ­£ç¢ºç­”æ¡ˆå¡)
                    if (!cardEl.classList.contains('flipped')) {
                        const wordData = currentQuestionData.currentOptionsData[i];

                        // ç¿»è½‰å¡ç‰Œ
                        cardEl.classList.add('flipped');
                        
                        // è¨­ç½®å¡ç‰ŒèƒŒé¢å…§å®¹
                        updateCardBackContent(i, wordData);
                    }
                }

                // é¡¯ç¤ºã€Œä¸‹ä¸€é¡Œã€æŒ‰éˆ•
                setTimeout(() => {
                    nextButton.classList.remove('scale-0', 'invisible');
                    nextButton.classList.add('scale-100');
                }, 800); // ç•™ä¸€é»æ™‚é–“è®“æœ€å¾Œä¸€æ‰¹å¡ç‰‡å®Œæˆç¿»è½‰
            }, 5000); // å»¶é² 5 ç§’
        }

        /**
         * é¡¯ç¤ºæç¤ºè¨Šæ¯
         */
        function showMessage(msg, colorClass) {
            messageBoxEl.textContent = msg;
            messageBoxEl.className = `text-xl font-bold text-center transition-opacity duration-300 opacity-100 min-h-[1.5rem] ${colorClass} flex-grow mx-4`;
        }

        /**
         * åŠ è¼‰ä¸‹ä¸€é¡Œæˆ–çµæŸéŠæˆ²
         */
        function loadNextQuestion() {
            currentQuestionIndexInBatch++; // ç§»å‹•åˆ°ä¸‹ä¸€é¡Œ

            if (currentQuestionIndexInBatch < gameQuestions.length) {
                // ç¹¼çºŒä¸‹ä¸€é¡Œ
                setupQuestion();
            } else {
                // éŠæˆ²çµæŸ
                nextButton.classList.remove('scale-100');
                nextButton.classList.add('scale-0', 'invisible');
                
                showMessage(`ğŸ‰ éŠæˆ²çµæŸï¼æ‚¨çš„æœ€çµ‚å¾—åˆ†æ˜¯ ${score}/${gameQuestions.length}ã€‚`, 'text-yellow-400');
                
                // é¡¯ç¤ºé‡æ–°é–‹å§‹æŒ‰éˆ•
                setTimeout(() => {
                    nextButton.textContent = "é‡æ–°é–‹å§‹";
                    nextButton.classList.remove('scale-0', 'invisible');
                    nextButton.classList.add('scale-100');
                    nextButton.onclick = initializeGame;
                }, 1000);
            }
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œï¼Œå•Ÿå‹•éŠæˆ²
        window.onload = initializeGame;
    </script>

</body>
</html>