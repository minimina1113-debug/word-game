<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚å­¸è©èª - V7.0 æœ€çµ‚å„ªåŒ–ç‰ˆ</title>
    <style>
        /* --- 1. æ ¸å¿ƒä¿®æ­£ï¼šå¼·åˆ¶è¼‰å…¥æ•™è‚²éƒ¨æ¨™æº–å®‹é«” (ä¾›å­—é«”æ›¿æ›åƒè€ƒ) --- */
        @font-face {
            font-family: 'TW-Sung';
            src: url('https://cdn.jsdelivr.net/gh/max32002/TW-Sung@2.128/TW-Sung-90ms.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        :root {
            --primary-color: #FF9A9E;
            --accent-color: #4facfe;
            --main-font: 'TW-Sung', "Microsoft JhengHei", sans-serif; 
        }

        body {
            font-family: var(--main-font);
            background-color: #E0F7FA;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        /* å°è¦½åˆ— */
        .nav-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            background: white;
            padding: 8px 20px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .nav-btn {
            border: none;
            background: none;
            font-size: 1.1em;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 30px;
            color: #888;
            font-weight: bold;
            transition: 0.3s;
        }

        .nav-btn.active {
            background-color: var(--accent-color);
            color: white;
        }

        /* å®¹å™¨è¨­å®š */
        .container {
            display: none;
            width: 90%;
            max-width: 500px;
            flex-direction: column;
            align-items: center;
        }

        .container.active {
            display: flex;
            animation: fadeIn 0.5s;
        }

        /* --- å­¸ç¿’å¡ç‰‡æ¨£å¼ --- */
        .flashcard {
            background: white;
            width: 320px;
            height: 500px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            border: 8px solid #fff;
            outline: 4px dashed var(--primary-color);
            padding-top: 20px;
            box-sizing: border-box;
        }

        .speak-icon {
            cursor: pointer;
            font-size: 0.9em;
            background: #eee;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            color: #555;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .vertical-text-container {
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px; 
        }

        /* åœ‹å­—æ¨£å¼ - é è¨­ */
        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-size: 4.5em; 
            font-weight: bold;
            color: #333;
            font-family: var(--main-font); 
            letter-spacing: 0.4em; 
        }
        /* åœ‹å­—æ¨£å¼ - å››å­—è©èªå„ªåŒ–ï¼šç¸®å°å­—é«”ä»¥å®¹ç´å››å€‹å­— */
        .vertical-text.four-char {
            font-size: 3.5em; /* ç¸®å°å­—é«” */
            letter-spacing: 0.2em;
        }

        ruby rt { display: none; } 

        .meaning-box {
            background-color: #FFF3E0;
            border-radius: 15px;
            width: 85%;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-sizing: border-box;
        }

        .meaning-title { font-size: 0.9em; color: #aaa; margin-bottom: 5px; }
        .meaning-content { font-size: 1.3em; color: #5D4037; font-weight: bold; }

        /* --- æ¸¬é©—æ¨¡å¼æ¨£å¼ --- */
        .progress-display {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            width: 100%;
            text-align: center;
        }
        
        #quizSummary { display:none; text-align:center; padding: 30px; background: white; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; }
        .quiz-header { font-size: 1.8em; font-weight: bold; color: var(--accent-color); margin: 10px 0 20px 0; background: white; padding: 10px 30px; border-radius: 15px; }
        .question-text { font-size: 1.2em; color: #555; margin-bottom: 15px; text-align: center; }
        .option-btn { background: white; border: 2px solid #ddd; padding: 12px; border-radius: 12px; font-size: 1.1em; text-align: left; cursor: pointer; margin-bottom: 10px; width: 100%; box-sizing: border-box; transition: 0.2s; }
        .option-btn:hover { border-color: var(--accent-color); background-color: #F0F9FF; }
        .option-btn.correct { background-color: #C8E6C9; border-color: #4CAF50; color: #2E7D32; }
        .option-btn.wrong { background-color: #FFCDD2; border-color: #F44336; color: #C62828; }
        .control-area { display: flex; gap: 20px; margin-top: 20px; }
        .btn-main { padding: 10px 25px; font-size: 1.1em; border: none; border-radius: 50px; background-color: var(--accent-color); color: white; cursor: pointer; }
        .btn-prev { background-color: #ccc; }

    </style>
</head>
<body>

    <div class="nav-bar">
        <button class="nav-btn active" id="btnStudy" onclick="switchMode('study')">ğŸ“– å­¸ç¿’</button>
        <button class="nav-btn" id="btnQuiz" onclick="switchMode('quiz')">âœï¸ æ¸¬é©—</button>
    </div>

    <div id="studyContainer" class="container active">
        <select id="wordSelector" onchange="jumpToWord(this.value)" style="margin-bottom: 15px; padding: 10px; font-size: 1.1em; border-radius: 8px; border: 2px solid var(--primary-color);">
            </select>

        <div class="flashcard">
            <div class="speak-icon" onclick="speakCurrentWord()">ğŸ”Š è½ç™¼éŸ³</div>
            
            <div class="vertical-text-container">
                <div class="vertical-text" id="studyWord">
                    è¼‰å…¥ä¸­...
                </div>
            </div>

            <div class="meaning-box">
                <div class="meaning-title">æ„æ€æ˜¯ï¼š</div>
                <div class="meaning-content" id="studyMeaning">è¼‰å…¥ä¸­...</div>
            </div>
        </div>

        <div class="control-area">
            <button class="btn-main btn-prev" onclick="prevCard()">ä¸Šä¸€å¼µ</button>
            <button class="btn-main" onclick="nextCard()">ä¸‹ä¸€å¼µ</button>
        </div>
    </div>

    <div id="quizContainer" class="container">
        
        <div class="progress-display" id="quizProgress"></div>

        <div id="quizSummary">
            <h2 style="color: var(--accent-color);">æ¸¬é©—çµæœ</h2>
            <p id="summaryText" style="font-size: 1.5em; font-weight: bold;"></p>
            <p style="font-size: 1.1em; color: #777; margin-bottom: 20px;">æ­å–œå®Œæˆä¸€è¼ªæ¸¬é©—ï¼</p>
            <button class="btn-main" onclick="startNewQuizRound()" style="background-color: #4CAF50;">å†æ¸¬ä¸€æ¬¡</button>
        </div>

        <div id="quizContent">
            <div class="quiz-header" id="quizTargetWord">é¡Œç›®</div>
            <div class="question-text">é¸å‡ºæ­£ç¢ºçš„å¥å­ï¼š</div>
            <div id="quizOptions" style="width:100%"></div>
            <div id="quizFeedback" style="min-height:30px; color:var(--accent-color); font-weight:bold; margin-top:10px;"></div>
            <button class="btn-main" onclick="nextQuiz()" style="margin-top:10px; background-color:#FF9A9E">ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <script>
        // --- 1. è³‡æ–™åº« (V6.0 è³‡æ–™åº«ï¼Œå…§å®¹ä¸è®Š) ---
        const vocabData = [
            { 
                word: "é¢¨å…‰", 
                zhuyin: ["ã„ˆã„¥", "ã„ã„¨ã„¤"], 
                meaning: "ç¾éº—çš„æ™¯è‰²ï¼Œæˆ–å½¢å®¹å ´é¢å…‰é‡‡ã€æœ‰é¢å­ã€‚", 
                sentence: "å‡æ—¥çš„é™½æ˜å±±ç¸½æ˜¯éŠå®¢å¦‚ç¹”ï¼Œæ²¿é€”çš„è‡ªç„¶_____éå¸¸è¿·äººã€‚" 
            },
            { 
                word: "ä»Šéæ˜”æ¯”", 
                zhuyin: ["ã„ã„§ã„£", "ã„ˆã„Ÿ", "ã„’ã„§ËŠ", "ã„…ã„§Ë‡"], 
                meaning: "ç¾åœ¨çš„æƒ…æ³å’Œéå»å®Œå…¨ä¸ä¸€æ¨£äº†ï¼ˆé€šå¸¸æŒ‡è®Šå¥½äº†ï¼‰ã€‚", 
                sentence: "è‡ªå¾æœ‰äº†æ·é‹ï¼Œå¾æˆ‘å®¶åˆ°å¸‚ä¸­å¿ƒçš„äº¤é€šä¾¿åˆ©æ€§ç°¡ç›´æ˜¯_____ã€‚" 
            },
            { 
                word: "è²¨æ¯”ä¸‰å®¶", 
                zhuyin: ["ã„ã„¨ã„›Ë‹", "ã„…ã„§Ë‡", "ã„™ã„¢", "ã„ã„§ã„š"], 
                meaning: "è²·æ±è¥¿æ™‚è¦å¤šæ¯”è¼ƒå¹¾å®¶ï¼Œæ‰ä¸æœƒåƒè™§ã€‚", 
                sentence: "è³¼è²·é«˜åƒ¹ä½çš„å•†å“ï¼Œç²¾æ˜çš„æ¶ˆè²»è€…éƒ½çŸ¥é“ä¸€å®šè¦_____æ‰èƒ½è²·åˆ°æœ€åˆ’ç®—çš„åƒ¹æ ¼ã€‚" 
            },
            { 
                word: "æ­¤èµ·å½¼è½", 
                zhuyin: ["ã„˜Ë‡", "ã„‘ã„§Ë‡", "ã„…ã„§Ë‡", "ã„Œã„¨ã„›Ë‹"], 
                meaning: "é€™è£¡èµ·ä¾†ï¼Œé‚£è£¡è½ä¸‹ã€‚å½¢å®¹é€£çºŒä¸æ–·ã€‚", 
                sentence: "æ¼”å”±æœƒä¸Šï¼Œè§€çœ¾çš„æ­¡å‘¼è²å’Œå°–å«è²_____ï¼Œæ°£æ°›éå¸¸ç†±çƒˆã€‚" 
            },
            { 
                word: "æˆæœ¬", 
                zhuyin: ["ã„”ã„¥ËŠ", "ã„…ã„£Ë‡"], 
                meaning: "è£½é€ ç‰©å“æˆ–ç¶“ç‡Ÿäº‹æ¥­æ‰€æŠ•å…¥çš„è²»ç”¨ã€‚", 
                sentence: "å•†å®¶ç‚ºäº†å¸å¼•é¡§å®¢ï¼Œæ¨å‡ºäº†è¨±å¤šå„ªæƒ æ´»å‹•ï¼Œé›–ç„¶å£“ç¸®äº†ç²åˆ©ï¼Œä½†èƒ½é™ä½å®£å‚³_____ã€‚" 
            },
            { 
                word: "è®šä¸çµ•å£", 
                zhuyin: ["ã„—ã„¢Ë‹", "ã„…ã„¨Ë‹", "ã„ã„©ã„ËŠ", "ã„ã„¡Ë‡"], 
                meaning: "ä¸æ–·åœ°ç¨±è®šï¼Œè¡¨ç¤ºéå¸¸å¥½ã€‚", 
                sentence: "åª½åª½ç²¾å¿ƒè£½ä½œçš„ç”Ÿæ—¥è›‹ç³•è®“æ‰€æœ‰åƒåŠ æ´¾å°çš„è¦ªå‹éƒ½_____ã€‚" 
            },
            { 
                word: "æ¨£è²Œ", 
                zhuyin: ["ã„§ã„¤Ë‹", "ã„‡ã„ Ë‹"], 
                meaning: "æŒ‡äººçš„å®¹è²Œã€å¤–è¡¨æˆ–äº‹ç‰©çš„å¤–è§€å½¢æ…‹ã€‚", 
                sentence: "å‰›å‡ºç”Ÿçš„å°è²“å’ªæœ‰è‘—æ¯›èŒ¸èŒ¸ã€éå¸¸å¯æ„›çš„_____ã€‚" 
            },
            { 
                word: "ç›®ä¸æš‡çµ¦", 
                zhuyin: ["ã„‡ã„¨Ë‹", "ã„…ã„¨Ë‹", "ã„’ã„§ã„šËŠ", "ã„ã„ŸË‡"], 
                meaning: "çœ¼ç›ä¾†ä¸åŠçœ‹ã€‚å½¢å®¹æ™¯è‰²æˆ–äº‹ç‰©å¤ªå¤šå¤ªç¾ï¼Œç„¡æ³•ä¸€çœ¼çœ‹å®Œã€‚", 
                sentence: "å¤œå¸‚è£¡çš„æ”¤ä½ç³ç‘¯æ»¿ç›®ï¼Œå„ç¨®æ–°å¥‡çš„å°åƒè®“äººçœ‹å¾—_____ã€‚" 
            },
            { 
                word: "å¾—å„Ÿæ‰€é¡˜", 
                zhuyin: ["ã„‰ã„œËŠ", "ã„”ã„¤ËŠ", "ã„™ã„¨ã„›Ë‡", "ã„©ã„¢Ë‹"], 
                meaning: "å¯¦ç¾äº†è‡ªå·±é•·ä¹…ä»¥ä¾†çš„é¡˜æœ›ã€‚", 
                sentence: "ç¶“éå¤šå¹´çš„åŠªåŠ›å’Œæº–å‚™ï¼Œå“¥å“¥çµ‚æ–¼è€ƒä¸Šç†æƒ³çš„å¤§å­¸ï¼Œç®—æ˜¯_____ã€‚" 
            },
            { 
                word: "ä¸€è¦‹å¦‚æ•…", 
                zhuyin: ["ã„§", "ã„ã„§ã„¢Ë‹", "ã„–ã„¨ËŠ", "ã„ã„¨Ë‹"], 
                meaning: "ç¬¬ä¸€æ¬¡è¦‹é¢å°±åƒè€æœ‹å‹ä¸€æ¨£ï¼Œéå¸¸æŠ•ç·£ã€‚", 
                sentence: "å„˜ç®¡ä»–å€‘æ˜¯åˆæ¬¡è¦‹é¢ï¼Œä½†èŠå¤©ååˆ†æŠ•æ©Ÿï¼Œå¾ˆå¿«å°±æˆç‚º_____çš„å¥½æœ‹å‹ã€‚" 
            }
        ];

        let currentIndex = 0; // å­¸ç¿’æ¨¡å¼ç´¢å¼•
        
        // æ¸¬é©—æ¨¡å¼ç‹€æ…‹è®Šæ•¸
        let totalQuizzes = vocabData.length;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let quizOrder = []; // é¡Œç›®é †åº
        let currentQuestionIndex = 0; // ç›®å‰ç­”åˆ°ç¬¬å¹¾é¡Œ

        // --- 2. å­¸ç¿’æ¨¡å¼åŠŸèƒ½ ---

        function populateDropdown() {
            const selector = document.getElementById('wordSelector');
            if (!selector) return;

            selector.innerHTML = '';
            vocabData.forEach((data, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.innerText = `${data.word} (${data.zhuyin.join('')})`; 
                selector.appendChild(option);
            });
        }
        
        function jumpToWord(index) {
            currentIndex = parseInt(index);
            renderStudyCard();
        }

        function renderStudyCard() {
            const data = vocabData[currentIndex];
            const wordDiv = document.getElementById('studyWord');
            const meaningDiv = document.getElementById('studyMeaning');
            const selector = document.getElementById('wordSelector');

            if (!wordDiv || !meaningDiv) return;

            // åˆ¤æ–·å­—æ•¸ä¸¦èª¿æ•´å­—é«”å¤§å° Class
            wordDiv.className = 'vertical-text'; // é‡è¨­ class
            if (data.word.length > 2) {
                wordDiv.classList.add('four-char');
            }

            // çµ„åˆåœ‹å­— HTML (æ³¨éŸ³å·²éš±è—åœ¨ CSS)
            let htmlHTML = "";
            for (let i = 0; i < data.word.length; i++) {
                let zy = data.zhuyin[i] ? data.zhuyin[i] : "";
                htmlHTML += `<ruby>${data.word[i]}<rt>${zy}</rt></ruby>`;
            }
            
            wordDiv.innerHTML = htmlHTML;
            meaningDiv.innerText = data.meaning;

            if (selector) {
                selector.value = currentIndex;
            }
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % vocabData.length;
            renderStudyCard();
        }

        function prevCard() {
            currentIndex = (currentIndex - 1 + vocabData.length) % vocabData.length;
            renderStudyCard();
        }

        function speakCurrentWord() {
            const msg = new SpeechSynthesisUtterance();
            msg.text = vocabData[currentIndex].word;
            msg.lang = 'zh-TW';
            msg.rate = 0.8;
            window.speechSynthesis.speak(msg);
        }

        // --- 3. æ¸¬é©—æ¨¡å¼åŠŸèƒ½ (æ–°å¢é€²åº¦æ¢) ---
        
        function updateQuizProgress() {
             const progressDiv = document.getElementById('quizProgress');
             if (currentQuestionIndex < totalQuizzes) {
                 progressDiv.innerText = `ç¬¬ ${currentQuestionIndex + 1} é¡Œ / å…± ${totalQuizzes} é¡Œ`;
             } else {
                 progressDiv.innerText = '';
             }
         }

        function shuffleQuizOrder() {
            quizOrder = Array.from({ length: vocabData.length }, (_, i) => i);
            quizOrder.sort(() => Math.random() - 0.5);
        }

        function switchMode(mode) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.container').forEach(con => con.classList.remove('active'));
            
            // é‡ç½®é€²åº¦é¡¯ç¤ºå€å¡Š
            document.getElementById('quizProgress').style.display = 'none';

            if(mode === 'study') {
                document.getElementById('btnStudy').classList.add('active');
                document.getElementById('studyContainer').classList.add('active');
                renderStudyCard();
            } else {
                document.getElementById('btnQuiz').classList.add('active');
                document.getElementById('quizContainer').classList.add('active');
                initQuiz(); 
                document.getElementById('quizProgress').style.display = 'block';
            }
        }
        
        function initQuiz() {
            shuffleQuizOrder();
            currentQuestionIndex = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            totalQuizzes = vocabData.length; 
            document.getElementById('quizSummary').style.display = 'none';
            document.getElementById('quizContent').style.display = 'block';
            renderQuizQuestion();
            updateQuizProgress(); // åˆå§‹åŒ–é€²åº¦
        }

        function renderQuizQuestion() {
            if (currentQuestionIndex >= totalQuizzes) {
                showQuizSummary();
                return;
            }
            
            const quizIndex = quizOrder[currentQuestionIndex];
            const currentData = vocabData[quizIndex];
            
            document.getElementById('quizTargetWord').innerText = currentData.word;
            document.getElementById('quizFeedback').innerText = "";
            
            const optionsDiv = document.getElementById('quizOptions');
            optionsDiv.innerHTML = "";

            let options = [];
            options.push({ text: currentData.sentence, isCorrect: true, word: currentData.word });

            let otherSentences = vocabData
                .filter((_, idx) => idx !== quizIndex)
                .map(item => item.sentence);
            
            otherSentences.sort(() => Math.random() - 0.5);
            
            let wrongCount = Math.min(3, otherSentences.length);
            for(let i=0; i<wrongCount; i++) {
                options.push({ text: otherSentences[i], isCorrect: false });
            }

            options.sort(() => Math.random() - 0.5);

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.text;
                btn.onclick = function() { checkAnswer(btn, opt.isCorrect, currentData.word) };
                optionsDiv.appendChild(btn);
            });
            
            updateQuizProgress(); // æ›´æ–°é€²åº¦
        }

        function checkAnswer(btn, isCorrect, correctWord) {
            const allBtns = document.querySelectorAll('#quizOptions .option-btn');
            allBtns.forEach(b => b.onclick = null); 

            if (isCorrect) {
                btn.classList.add('correct');
                btn.innerText = btn.innerText.replace("_____", `ã€${correctWord}ã€‘`);
                document.getElementById('quizFeedback').innerText = "ğŸ‰ ç­”å°äº†ï¼";
                correctAnswers++; 
            } else {
                btn.classList.add('wrong');
                document.getElementById('quizFeedback').innerText = "âŒ ç­”æ¡ˆæ˜¯åˆ¥äººå–”ï¼";
                wrongAnswers++; 
                
                allBtns.forEach(b => {
                    if (b.innerText.includes(vocabData[quizOrder[currentQuestionIndex]].sentence)) {
                        b.classList.add('correct');
                        b.innerText = b.innerText.replace("_____", `ã€${correctWord}ã€‘`);
                    }
                });
            }
        }

        function nextQuiz() {
            currentQuestionIndex++;
            renderQuizQuestion();
        }

        function showQuizSummary() {
            const summaryDiv = document.getElementById('quizSummary');
            const contentDiv = document.getElementById('quizContent');
            const summaryText = document.getElementById('summaryText');
            
            document.getElementById('quizProgress').innerText = ''; // æ¸…ç©ºé€²åº¦æ¢

            contentDiv.style.display = 'none';
            summaryDiv.style.display = 'block';
            
            const percentage = totalQuizzes > 0 ? Math.round((correctAnswers / totalQuizzes) * 100) : 0;
            summaryText.innerHTML = `ç­”å° ${correctAnswers} é¡Œï¼Œç­”éŒ¯ ${wrongAnswers} é¡Œã€‚<br>å¾—åˆ†ç‡ï¼š${percentage}%`;
        }

        function startNewQuizRound() {
            initQuiz();
        }


        // --- 4. å•Ÿå‹• ---
        window.onload = function() {
            populateDropdown();
            renderStudyCard();
        };

    </script>
</body>
</html>